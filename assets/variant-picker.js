if(!customElements.get("variant-picker")){class t extends HTMLElement{constructor(){super(),this.section=this.closest(".js-product"),this.productForm=this.section.querySelector(".js-product-form"),this.optionSelectors=this.querySelectorAll(".option-selector:not(.option-selector--custom)"),this.nativeSelector=document.getElementById(`variants-${this.section.dataset.section}`),this.data=this.getVariantData(),this.selectedOptions=this.getSelectedOptions(),this.variant=this.getSelectedVariant(),this.updateAvailability(),this.updateAddToCartButton(),this.addEventListener("change",this.handleVariantChange.bind(this)),this.setAttribute("loaded","")}handleVariantChange(e){this.selectedOptions=this.getSelectedOptions(),this.variant=this.getSelectedVariant(),this.preSelection=!this.variant&&null===this.selectedOptions.find(t=>null===t),this.updateUrl(e),this.updateVariantInput(),this.updateAddToCartButton(),this.updateAvailability(),this.updatePrice(),this.updateBackorderText(),this.updatePickupAvailability(),this.updateSku(),this.updateBarcode(),t.updateLabelText(e),this.dispatchEvent(new CustomEvent("on:variant:change",{bubbles:!0,detail:{form:this.productForm,variant:this.variant,allVariants:this.data.variants,selectedOptions:this.selectedOptions}}))}updateAddToCartButton(){if(!this.productForm||this.selectedOptions.indexOf(null)>-1)return;this.addBtn=this.addBtn||this.productForm.querySelector('[name="add"]');let t=this.variant&&this.variant.available,e=this.variant?theme.strings.noStock:theme.strings.noVariant;this.addBtn.disabled=!t,this.addBtn.textContent=t?this.addBtn.dataset.addToCartText:e}static updateOptionAvailability(t,e,i){let a=t,s=e?theme.strings.noStock:theme.strings.noVariant;if(a.classList.toggle("is-unavailable",!i),a.classList.toggle("is-nonexistent",!e),t.classList.contains("custom-select__option")){let r=a.querySelector("em");r&&(r.hidden=i),i||(r?r.textContent=s:a.innerHTML=`${a.innerHTML} <em class="pointer-events-none">${s}</em>`)}else i?a.nextElementSibling.removeAttribute("title"):a.nextElementSibling.title=s}updateAvailability(){if("false"===this.dataset.showAvailability)return;let{availabilityMode:e}=this.dataset,i=this.variant;this.variant||(i={options:this.selectedOptions}),"selection"===e?(this.querySelectorAll(".js-option").forEach(e=>{t.updateOptionAvailability(e,!1,!1)}),this.optionSelectors.forEach((e,a)=>{this.data.variants.forEach(s=>{let r=0;if(s.options.forEach((t,e)=>{t===i.options[e]&&e!==a&&(r+=1)}),r===i.options.length-1){let n=e.querySelectorAll(".js-option"),o=Array.from(n).find(t=>"dropdown"===e.dataset.selectorType?t.dataset.value===s.options[a]:t.value===s.options[a]);o&&t.updateOptionAvailability(o,!0,s.available)}})})):this.optionSelectors.forEach((e,i)=>{let a=e.querySelectorAll('.js-option:not([data-value=""])');a.forEach(a=>{let s="dropdown"===e.dataset.selectorType?a.dataset.value:a.value,r=!1,n=!1;this.data.variants.forEach(t=>{let e=0;for(let a=0;a<i;a+=1)(t.options[a]===this.selectedOptions[a]||null===this.selectedOptions[a])&&(e+=1);t.options[i]===s&&e===i&&(r=!0,t.available&&(n=!0))}),t.updateOptionAvailability(a,r,n)})})}updateBackorderText(){if(this.backorder=this.backorder||this.section.querySelector(".backorder"),!this.backorder)return;let t=!0;if(this.variant&&this.variant.available){let{inventory:e}=this.data.formatted[this.variant.id];if(this.variant.inventory_management&&"none"===e){let i=this.backorder.querySelector(".backorder__product"),a=this.section.querySelector(".product-title"),s=this.variant.title.includes("Default")?"":` - ${this.variant.title}`;i.textContent=`${a.textContent}${s}`,t=!1}}this.backorder.hidden=t}static updateLabelText(t){let e=t.target.closest(".option-selector");if("dropdown"===e.dataset.selectorType)return;let i=e.querySelector(".js-color-text");i&&(i.textContent=t.target.nextElementSibling.querySelector(".js-value").textContent)}updatePickupAvailability(){this.pickUpAvailability=this.pickUpAvailability||this.section.querySelector("pickup-availability"),this.pickUpAvailability&&(this.variant&&this.variant.available?this.pickUpAvailability.getAvailability(this.variant.id):(this.pickUpAvailability.removeAttribute("available"),this.pickUpAvailability.innerHTML=""))}updatePrice(){if(this.price=this.price||this.section.querySelector(".product-price .price"),!this.price)return;let{variant:t}=this;if(this.preSelection){t=this.data.variants[0];for(let e=1;e<this.data.variants.length;e+=1)this.data.variants[e].price<t.price&&(t=this.data.variants[e])}if(t){let i=this.price.querySelector(".price__current"),a=this.price.querySelector(".price__was"),s=this.price.querySelector(".unit-price");if(i.innerHTML=this.data.formatted[t.id].price,a&&(a.innerHTML=this.data.formatted[t.id].compareAtPrice||""),t.unit_price_measurement){let r=this.price.querySelector(".unit-price__price"),n=this.price.querySelector(".unit-price__unit"),o=t.unit_price_measurement.reference_value,l=t.unit_price_measurement.reference_unit;r.innerHTML=this.data.formatted[t.id].unitPrice,n.textContent=1===o?l:`${o} ${l}`,s.hidden=!1}else s&&(s.hidden=!0);this.price.classList.toggle("price--on-sale",t.compare_at_price>t.price),this.price.classList.toggle("price--sold-out",!t.available&&!this.preSelection)}this.price.querySelector(".price__default").hidden=!this.variant&&!this.preSelection,this.price.querySelector(".price__no-variant").hidden=this.variant||this.preSelection;let c=this.price.querySelector(".price__from");c&&(c.hidden=!this.preSelection)}updateSku(){if(this.sku=this.sku||this.section.querySelector(".product-sku__value"),!this.sku)return;let t=this.variant&&this.variant.sku;this.sku.textContent=t?this.variant.sku:"",this.sku.parentNode.hidden=!t}updateBarcode(){if(this.barcode=this.barcode||this.section.querySelector(".product-barcode__value"),!this.barcode)return;let t=this.variant&&this.variant.barcode;this.barcode.textContent=t?this.variant.barcode:"",this.barcode.parentNode.hidden=!t}updateUrl(t){if(!t||"change"!==t.type||"false"===this.dataset.updateUrl)return;let e=this.variant?`${this.dataset.url}?variant=${this.variant.id}`:this.dataset.url;window.history.replaceState({},"",e)}updateVariantInput(){this.forms=this.forms||this.section.querySelectorAll(".js-product-form, .js-instalments-form"),this.forms.forEach(t=>{let e=t.querySelector('[name="id"]');e.value=this.variant?this.variant.id:"",e.dispatchEvent(new Event("change",{bubbles:!0}))})}getVariantData(){let t=this.querySelector('[type="application/json"]');return JSON.parse(t.textContent)}getSelectedOptions(){let t=[];return this.optionSelectors.forEach(e=>{if("dropdown"===e.dataset.selectorType){let i=e.querySelector('.custom-select__option[aria-selected="true"]');t.push(i&&""!==i.dataset.value?i.dataset.value:null)}else{let a=e.querySelector("input:checked");t.push(a?a.value:null)}}),t}getSelectedVariant(){return this.data.variants.find(t=>t.options.every((t,e)=>t===this.selectedOptions[e]))}}customElements.define("variant-picker",t)}
