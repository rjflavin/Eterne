if(!customElements.get("shipping-calculator")){class t extends HTMLElement{constructor(){super(),this.button=this.querySelector("button"),this.button.addEventListener("click",this.handleSubmit.bind(this))}init(){this.country=this.querySelector(".js-country-select"),this.province=this.querySelector(".js-province-select"),this.zip=this.querySelector(".js-zip-input"),this.rates=this.querySelector(".js-rates"),this.errors=this.querySelector(".js-errors"),this.initialised=!0}async handleSubmit(t){t.preventDefault(),this.initialised||this.init(),this.errors.hidden=!0,this.rates.hidden=!0,this.button.disabled=!0,this.button.classList.add("is-loading");let s=`shipping_address[zip]=${this.zip.value}&shipping_address[country]=${this.country.value}&shipping_address[province]=${this.province.value}`;try{let e=await fetch(`${theme.routes.cart}/shipping_rates.json?${s}`),i=await e.json();e.ok?this.showRates(i):this.showErrors(i)}catch(r){console.log(r)}finally{this.button.classList.remove("is-loading"),this.button.disabled=!1}}showRates(t){let s=this.rates.querySelector(".js-rates-heading"),e=this.rates.querySelector(".js-rates-text");if(e.innerHTML="",t.shipping_rates&&t.shipping_rates.length){let i=1===t.shipping_rates.length?"singleRate":"multipleRates",r="";t.shipping_rates.forEach(t=>{let s=theme.settings.moneyWithCurrencyFormat.replace(/\{\{\s*(\w+)\s*\}\}/,t.price);r+=`<li>${t.name}: ${s}</li>`}),s.hidden=!1,s.textContent=theme.strings.shippingCalculator[i],e.innerHTML=`<ul class="styled-list">${r}</ul>`}else s.hidden=!0,e.innerHTML=theme.strings.shippingCalculator.noRates;this.rates.hidden=!1}showErrors(t){let s="";Object.keys(t).forEach(e=>{s+=`<li>${t[e]}</li>`}),this.errors.querySelector(".js-errors-text").innerHTML=`<ul class="styled-list">${s}</ul>`,this.errors.hidden=!1}}customElements.define("shipping-calculator",t)}
