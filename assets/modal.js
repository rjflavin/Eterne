const trapFocusHandlers={};function removeTrapFocus(e=null){document.removeEventListener("focusin",trapFocusHandlers.focusin),document.removeEventListener("focusout",trapFocusHandlers.focusout),document.removeEventListener("keydown",trapFocusHandlers.keydown),e&&e.focus()}function trapFocus(e,t=e){let s=Array.from(e.querySelectorAll('summary, a[href], area[href], button:not([disabled]), input:not([type=hidden]):not([disabled]), select:not([disabled]), textarea:not([disabled]), object, iframe, audio[controls], video[controls], [tabindex]:not([tabindex^="-"])')),o=s[0],r=s[s.length-1];removeTrapFocus(),trapFocusHandlers.focusin=t=>{(t.target===e||t.target===r||t.target===o)&&document.addEventListener("keydown",trapFocusHandlers.keydown)},trapFocusHandlers.focusout=()=>{document.removeEventListener("keydown",trapFocusHandlers.keydown)},trapFocusHandlers.keydown=t=>{"Tab"===t.code&&(t.target!==r||t.shiftKey||(t.preventDefault(),o.focus()),(t.target===e||t.target===o)&&t.shiftKey&&(t.preventDefault(),r.focus()))},document.addEventListener("focusout",trapFocusHandlers.focusout),document.addEventListener("focusin",trapFocusHandlers.focusin),(t||e).focus()}class Modal extends HTMLElement{constructor(){super(),this.addEventListener("click",this.handleClick.bind(this))}handleClick(e){(e.target===this||e.target.matches(".js-close-modal"))&&this.close()}open(e){this.scrollY=window.scrollY,document.body.classList.add("fixed"),document.body.style.top=`-${this.scrollY}px`,this.setAttribute("open",""),this.openedBy=e,trapFocus(this),window.pauseAllMedia(),this.keyupHandler=e=>"Escape"===e.key&&this.close(),this.addEventListener("keyup",this.keyupHandler)}close(){document.body.style.top="",document.body.classList.remove("fixed"),window.scrollTo(0,this.scrollY),this.removeAttribute("open"),removeTrapFocus(this.openedBy),window.pauseAllMedia(),this.removeEventListener("keyup",this.keyupHandler)}}customElements.define("modal-dialog",Modal);
